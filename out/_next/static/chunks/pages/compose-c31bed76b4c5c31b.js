(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[676],{29007:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/compose",function(){return n(44620)}])},44620:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ej});var i=n(37876),l=n(14232),r=n(46584),s=n(58271),a=n(55471),o=n(55751),c=n(65754),d=n(87080),u=n(78753),h=n(38102);class x{static generate(e){let t=e.measures.map((e,t)=>({measure:{"@_number":t+1,note:e.voices[0].elements.map(e=>e.pitch?x.noteXML(e):x.restXML(e))}})),n={"score-partwise":{"@_version":"3.1","movement-title":e.title,part:{"@_id":"P1",measure:t.map(e=>e.measure)}}};return new h.A({ignoreAttributes:!1,format:!0}).build(n)}static noteXML(e){return{pitch:{step:e.pitch.step,alter:e.pitch.accidental,octave:e.pitch.octave},duration:Math.round(256*e.duration.value),voice:1,type:x.durationToType(e.duration.value)}}static restXML(e){return{rest:{},duration:Math.round(256*e.duration.value),voice:1,type:x.durationToType(e.duration.value)}}static durationToType(e){return({4:"whole",2:"half",1:"quarter",.5:"eighth",.25:"16th"})[e]||"quarter"}}var A=n(56062),f=n(28044),m=n(37610),p=n(12700),j=n(59100);class v{serialize(){return{duration:this.duration.serialize()}}static deserialize(e){return new v(j.A.deserialize(e.duration))}clone(){return new v(this.duration.clone())}constructor(e=new j.A("q")){this.duration=e}}var b=n(61302),g=n(35007),y=n(73173);class w{static parse(e){let t=new DOMParser().parseFromString(e,"application/xml"),n=new A.A,i=t.querySelector("movement-title");i&&(n.title=i.textContent);let l=t.querySelector("key > fifths");l&&(n.keySignature=new g.A({"-7":"Cb","-6":"Gb","-5":"Db","-4":"Ab","-3":"Eb","-2":"Bb","-1":"F",0:"C",1:"G",2:"D",3:"A",4:"E",5:"B",6:"F#",7:"C#"}[l.textContent]||"C"));let r=t.querySelector("time > beats"),s=t.querySelector("time > beat-type");return r&&s&&(n.timeSignature=new y.A(parseInt(r.textContent),parseInt(s.textContent))),n.measures=[],t.querySelectorAll("measure").forEach((e,t)=>{let i=new f.A({index:t,timeSignature:n.timeSignature}),l=new m.A(0);e.querySelectorAll("note").forEach(e=>{let t=e.querySelector("rest"),n=e.querySelector("duration"),i=parseInt((null==n?void 0:n.textContent)||1)/256;if(t)l.addRest(new v(new j.A(i)));else{var r;let t=e.querySelector("pitch > step").textContent,n=parseInt(e.querySelector("pitch > octave").textContent),s=parseInt((null==(r=e.querySelector("pitch > alter"))?void 0:r.textContent)||0),a=new b.A(t,s,n);l.addNote(new p.A({pitch:a,duration:new j.A(i)}))}}),i.voices=[l],n.measures.push(i)}),n}}var C=n(90570);class S{static parse(e){var t;let n=new C.Midi(e),i=new A.A;n.header.timeSignatures.length>0&&(n.header.timeSignatures[0].timeSignature[0],n.header.timeSignatures[0].timeSignature[1]);let l=(null==(t=n.header.tempos[0])?void 0:t.bpm)||120,r=n.tracks.find(e=>e.notes.length>0);if(!r)return i;let s=r.notes.map(e=>({beat:e.time*(l/60),duration:e.duration*(l/60),midi:e.midi}));s.sort((e,t)=>e.beat-t.beat);let a=0,o=[];s.forEach(e=>{let t=.25*Math.round(e.beat/.25),n=.25*Math.round(e.duration/.25);n<.25&&(n=.25);let i=o.find(e=>.01>Math.abs(e.beat-t));i||(i={beat:t,notes:[],duration:n},o.push(i)),i.notes.push(e)}),o.sort((e,t)=>e.beat-t.beat);for(let e=0;e<o.length;e++){let t=o[e],n=o[e+1];if(t.beat>a+.01){let e=t.beat-a;(function(e,t,n){let i=t;k(n).forEach(t=>{let n=j.A.toBeats(t),l=new p.A(new b.A("B",0,4),new j.A(t));l.isRest=!0,e.addNote(i,l),i+=n})})(i,a,e),a=t.beat}let l=t.duration;n&&t.beat+l>n.beat&&(l=n.beat-t.beat),t.notes.forEach(e=>{let t=b.A.fromMidi(e.midi),n=k(l)[0],r=new p.A(t,new j.A(n)),s=function(e){let t=[64,59,55,50,45,40];for(let n=0;n<t.length;n++){let i=e-t[n];if(i>=0&&i<=4)return{string:n+1,fret:i}}for(let n=0;n<t.length;n++){let i=e-t[n];if(i>=0&&i<=12)return{string:n+1,fret:i}}for(let n=0;n<t.length;n++){let i=e-t[n];if(i>=0)return{string:n+1,fret:i}}return{string:1,fret:0}}(e.midi);r.string=s.string,r.fret=s.fret,i.addNote(a,r)}),a+=j.A.toBeats(k(l)[0])}return i}}function k(e){let t=[],n=e;for(;n>=3.99;)t.push("w"),n-=4;for(;n>=1.99;)t.push("h"),n-=2;for(;n>=.99;)t.push("q"),n-=1;for(;n>=.49;)t.push("8"),n-=.5;for(;n>=.24;)t.push("16"),n-=.25;return 0===t.length&&t.push("16"),t}var E=n(37309);class T{static generate(e){let t=[],n=0,i=0;return e.measures.forEach(e=>{e.voices.forEach(e=>{e.elements.forEach(e=>{let l=480*e.duration.total;e.pitch&&(t.push({deltaTime:i-n,type:"noteOn",noteNumber:e.pitch.midi,velocity:80}),t.push({deltaTime:l,type:"noteOff",noteNumber:e.pitch.midi,velocity:0}),n=i+l),i+=l})})}),new Blob([(0,E.writeMidi)({header:{format:0,numTracks:1,ticksPerBeat:480},tracks:[t]})],{type:"audio/midi"})}}class I{static saveXML(e){let t=x.generate(e);I._download(t,"score.musicxml","text/xml")}static saveMIDI(e){let t=T.generate(e);I._download(t,"score.mid","audio/midi")}static loadXML(e,t){let n=new FileReader;n.onload=()=>{t(w.parse(n.result))},n.readAsText(e)}static loadMIDI(e,t){let n=new FileReader;n.onload=()=>{t(S.parse(n.result))},n.readAsArrayBuffer(e)}static _download(e,t,n){let i=e instanceof Blob?e:new Blob([e],{type:n}),l=URL.createObjectURL(i),r=document.createElement("a");r.href=l,r.download=t,r.click()}}function M(){let{score:e,setScore:t}=(0,a.QG)(),[n,r]=l.useState(null);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.A,{onClick:e=>r(e.currentTarget),children:"File"}),(0,i.jsxs)(d.A,{open:!!n,anchorEl:n,onClose:()=>r(null),children:[(0,i.jsx)(u.A,{onClick:()=>{I.saveXML(e),r(null)},children:"Export MusicXML"}),(0,i.jsx)(u.A,{onClick:()=>{I.saveMIDI(e),r(null)},children:"Export MIDI"}),(0,i.jsx)(u.A,{onClick:()=>{document.getElementById("midi-upload").click(),r(null)},children:"Import MIDI"})]}),(0,i.jsx)("input",{type:"file",id:"midi-upload",accept:".mid,.midi",style:{display:"none"},onChange:e=>{let n=e.target.files[0];n&&I.loadMIDI(n,e=>{t(e)}),e.target.value=""}})]})}function R(){let{undoAction:e,redoAction:t}=(0,a.QG)(),[n,r]=(0,l.useState)(null);return(0,i.jsxs)(o.A,{sx:{display:"flex",gap:2,padding:1,borderBottom:"1px solid #ddd",background:"#eee"},children:[(0,i.jsx)(M,{}),(0,i.jsx)(c.A,{onClick:e=>r(e.currentTarget),children:"Edit"}),(0,i.jsxs)(d.A,{anchorEl:n,open:!!n,onClose:()=>r(null),children:[(0,i.jsx)(u.A,{onClick:()=>{e(),r(null)},children:"Undo"}),(0,i.jsx)(u.A,{onClick:()=>{t(),r(null)},children:"Redo"})]}),(0,i.jsx)(c.A,{disabled:!0,children:"View"}),(0,i.jsx)(c.A,{disabled:!0,children:"Help"})]})}var q=n(50993),_=n(71733),B=n(7579),L=n(51750),N=n(76342),D=n(54915),F=n(56057),P=n(36307),W=n(43130),z=n(86695),H=n(74879);function G(){var e,t,n,r;let{input:s,selection:c,updateScore:d}=(0,a.QG)(),[,u]=(0,l.useState)({}),h=e=>{let t=c.selected;t&&d(n=>{for(let i of n.measures)for(let n of i.voices){let i=n.elements.find(e=>e.note.id===t.id);if(i){i.note.technique=e,"bend"!==e||i.note.bend||(i.note.bend="Full");return}}})},x=e=>(0,i.jsx)(q.A,{title:"".concat(e," note"),children:(0,i.jsx)(_.A,{onClick:()=>s.setDuration(e),children:(0,i.jsx)(N.A,{})})});return(0,i.jsxs)(o.A,{sx:{display:"flex",gap:1,padding:1,borderBottom:"1px solid #ddd",background:"#fafafa"},children:[(0,i.jsx)(q.A,{title:"Select tool",children:(0,i.jsx)(_.A,{children:(0,i.jsx)(L.A,{})})}),(0,i.jsx)(q.A,{title:"Move Left",children:(0,i.jsx)(_.A,{onClick:()=>window.dispatchEvent(new CustomEvent("editor:move-cursor",{detail:-1})),children:(0,i.jsx)(D.A,{})})}),(0,i.jsx)(q.A,{title:"Move Right",children:(0,i.jsx)(_.A,{onClick:()=>window.dispatchEvent(new CustomEvent("editor:move-cursor",{detail:1})),children:(0,i.jsx)(F.A,{})})}),x("w")," ",x("h")," ",x("q")," ",x("8")," ",x("16"),(0,i.jsx)(B.A,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),(0,i.jsx)(q.A,{title:"Sharp (#)",children:(0,i.jsx)(_.A,{onClick:()=>s.setAccidental(1),color:1===s.activeAccidental?"primary":"default",sx:{fontWeight:"bold",fontSize:18},children:"♯"})}),(0,i.jsx)(q.A,{title:"Flat (♭)",children:(0,i.jsx)(_.A,{onClick:()=>s.setAccidental(-1),color:-1===s.activeAccidental?"primary":"default",sx:{fontWeight:"bold",fontSize:18},children:"♭"})}),(0,i.jsx)(B.A,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),(0,i.jsx)(q.A,{title:"Slide",children:(0,i.jsx)(_.A,{onClick:()=>h("slide"),color:(null==(e=c.selected)?void 0:e.technique)==="slide"?"primary":"default",children:(0,i.jsx)(P.A,{})})}),(0,i.jsx)(q.A,{title:"Hammer-on",children:(0,i.jsx)(_.A,{onClick:()=>h("hammer"),color:(null==(t=c.selected)?void 0:t.technique)==="hammer"?"primary":"default",children:(0,i.jsx)(z.A,{})})}),(0,i.jsx)(q.A,{title:"Pull-off",children:(0,i.jsx)(_.A,{onClick:()=>h("pull"),color:(null==(n=c.selected)?void 0:n.technique)==="pull"?"primary":"default",children:(0,i.jsx)(W.A,{})})}),(0,i.jsx)(q.A,{title:"Bend",children:(0,i.jsx)(_.A,{onClick:()=>h("bend"),color:(null==(r=c.selected)?void 0:r.technique)==="bend"?"primary":"default",children:(0,i.jsx)(H.A,{})})})]})}var O=n(19330),V=n(35294),X=n(40051),Q=n(68169);function U(){let{playback:e,score:t}=(0,a.QG)(),[n,r]=(0,l.useState)(120);return e?(0,i.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",gap:2,padding:1,borderBottom:"1px solid #ddd",background:"#fafafa"},children:[(0,i.jsx)(_.A,{onClick:()=>e.playScore(t),children:(0,i.jsx)(V.A,{})}),(0,i.jsx)(_.A,{onClick:()=>e.stop(),children:(0,i.jsx)(X.A,{})}),(0,i.jsx)(_.A,{onClick:()=>e.setLoop(0,4),children:(0,i.jsx)(Q.A,{})}),(0,i.jsx)(O.Ay,{value:n,min:40,max:200,sx:{width:200},onChange:(t,n)=>{r(n),e.setTempo(n)}}),n," BPM"]}):(0,i.jsx)(o.A,{sx:{display:"flex",alignItems:"center",padding:1,borderBottom:"1px solid #ddd"},children:"Loading audio engine…"})}var Y=n(35003),K=n(49576);function Z(){let{score:e,updateScore:t,selection:n,input:r,cursorBeat:s,setCursorBeat:h}=(0,a.QG)(),[x,A]=l.useState(null),[f,m]=l.useState(null),[v,w]=l.useState(null),[C,S]=l.useState(null),[k,E]=l.useState("q"),T=n.selected,I=e=>{t(t=>{t.clef=new K.A(e)}),A(null)},M=(e,n)=>{t(t=>{t.timeSignature=new y.A(e,n)}),m(null)},R=e=>{t(t=>{t.keySignature=new g.A(e)}),w(null)},q=e=>{if(!T||!T.pitch)return void S(null);t(t=>{let n=null;e:for(let e of t.measures)for(let t of e.voices){let e=t.elements.find(e=>e.note.id===T.id);if(e){n=e.note;break e}}n&&(n.articulations=n.articulations||[],n.articulations.push(e))}),S(null)};return(0,i.jsxs)(o.A,{sx:{width:220,borderRight:"1px solid #ddd",p:2,background:"#fafafa",overflowY:"auto",height:"100%"},children:[(0,i.jsx)(Y.A,{variant:"h6",sx:{mb:1},children:"Input"}),(0,i.jsx)(Y.A,{variant:"caption",display:"block",sx:{mb:.5},children:"Duration"}),(0,i.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[{l:"W",v:"w"},{l:"H",v:"h"},{l:"Q",v:"q"},{l:"8",v:"8"},{l:"16",v:"16"}].map(e=>(0,i.jsx)(c.A,{variant:k===e.v?"contained":"outlined",size:"small",onClick:()=>{var t;E(t=e.v),r&&r.setDuration(t)},sx:{minWidth:32,p:.5,fontSize:"0.75rem"},children:e.l},e.v))}),(0,i.jsx)(Y.A,{variant:"caption",display:"block",sx:{mb:.5},children:"Insert"}),(0,i.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:["C","D","E","F","G","A","B"].map(n=>(0,i.jsx)(c.A,{variant:"outlined",size:"small",onClick:()=>(n=>{if(!e)return;let i=new b.A(n,0,4),l=new j.A(k),r=new p.A(i,l);t(e=>{e.addNote(s,r)}),h(e=>e+l.total)})(n),sx:{minWidth:28,p:.5},children:n},n))}),(0,i.jsx)(c.A,{fullWidth:!0,variant:"outlined",size:"small",color:"warning",onClick:()=>{if(!e)return;let n=new j.A(k),i=new p.A(new b.A("B",0,4),n);i.isRest=!0,t(e=>{e.addNote(s,i)}),h(e=>e+n.total)},sx:{mb:2},children:"Rest"}),(0,i.jsx)(B.A,{sx:{mb:2}}),(0,i.jsx)(Y.A,{variant:"h6",sx:{mb:2},children:"Palette"}),(0,i.jsx)(c.A,{fullWidth:!0,variant:"outlined",onClick:e=>A(e.currentTarget),children:"Change Clef"}),(0,i.jsxs)(d.A,{anchorEl:x,open:!!x,onClose:()=>A(null),children:[(0,i.jsx)(u.A,{onClick:()=>I("treble"),children:"Treble"}),(0,i.jsx)(u.A,{onClick:()=>I("bass"),children:"Bass"}),(0,i.jsx)(u.A,{onClick:()=>I("alto"),children:"Alto"}),(0,i.jsx)(u.A,{onClick:()=>I("tenor"),children:"Tenor"})]}),(0,i.jsx)(c.A,{fullWidth:!0,variant:"outlined",sx:{mt:1},onClick:e=>m(e.currentTarget),children:"Time Signature"}),(0,i.jsxs)(d.A,{anchorEl:f,open:!!f,onClose:()=>m(null),children:[(0,i.jsx)(u.A,{onClick:()=>M(4,4),children:"4/4"}),(0,i.jsx)(u.A,{onClick:()=>M(3,4),children:"3/4"}),(0,i.jsx)(u.A,{onClick:()=>M(6,8),children:"6/8"}),(0,i.jsx)(u.A,{onClick:()=>M(2,4),children:"2/4"})]}),(0,i.jsx)(c.A,{fullWidth:!0,variant:"outlined",sx:{mt:1},onClick:e=>w(e.currentTarget),children:"Key Signature"}),(0,i.jsxs)(d.A,{anchorEl:v,open:!!v,onClose:()=>w(null),children:[(0,i.jsx)(u.A,{onClick:()=>R("C"),children:"C / Am"}),(0,i.jsx)(u.A,{onClick:()=>R("G"),children:"G / Em"}),(0,i.jsx)(u.A,{onClick:()=>R("D"),children:"D / Bm"}),(0,i.jsx)(u.A,{onClick:()=>R("A"),children:"A / F#m"}),(0,i.jsx)(u.A,{onClick:()=>R("E"),children:"E / C#m"}),(0,i.jsx)(u.A,{onClick:()=>R("F"),children:"F / Dm"}),(0,i.jsx)(u.A,{onClick:()=>R("Bb"),children:"Bb / Gm"}),(0,i.jsx)(u.A,{onClick:()=>R("Eb"),children:"Eb / Cm"})]}),(0,i.jsx)(c.A,{fullWidth:!0,variant:"outlined",sx:{mt:1},onClick:e=>S(e.currentTarget),disabled:!T,children:"Articulations"}),(0,i.jsxs)(d.A,{anchorEl:C,open:!!C,onClose:()=>S(null),children:[(0,i.jsx)(u.A,{onClick:()=>q("staccato"),children:"Staccato"}),(0,i.jsx)(u.A,{onClick:()=>q("accent"),children:"Accent"}),(0,i.jsx)(u.A,{onClick:()=>q("tenuto"),children:"Tenuto"})]})]})}var J=n(28836);let $=J.Ay;class ee{render(){if(!this.container||!this.score)return;this.container.innerHTML="";let e=new $.Renderer(this.container,$.Renderer.Backends.SVG);e.resize(900,1400);let t=e.getContext(),n=20,i=40;this.score.measures.forEach((e,l)=>{l%4==0&&0!==l&&(n=20,i+=120);let r=new $.Stave(n,i,200);if(0===l){var s;r.addClef((null==(s=this.score.clef)?void 0:s.name)||"treble").addTimeSignature(this.score.timeSignature.toString()).addKeySignature(this.score.keySignature.key)}r.setContext(t).draw();let a=[];e.voices.forEach(t=>{if(!t.elements.length)return;let n=new Map;t.elements.forEach(e=>{let t=e.beat;n.has(t)||n.set(t,[]),n.get(t).push(e.note)});let i=Array.from(n.keys()).sort((e,t)=>e-t),l=[];i.forEach(e=>{let t,i=n.get(e);if(!i||0===i.length)return;let r=i[0],s=(null==(a=r.duration)?void 0:a.symbol)||"q";if(r.isRest)t=new $.StaveNote({keys:["b/4"],duration:s+"r"});else{let e=i.map(e=>"".concat(e.pitch.step.toLowerCase()).concat(1===e.pitch.alter?"#":-1===e.pitch.alter?"b":2===e.pitch.alter?"##":-2===e.pitch.alter?"bb":"","/").concat(e.pitch.octave));var a,o,c=t=new $.StaveNote({keys:e,duration:s}),d=this.selection;let n=null==(o=c.getSVGElement)?void 0:o.call(c);n&&(n.style.cursor="pointer",n.addEventListener("click",e=>{e.stopPropagation(),d.select(r)}))}l.push(t)});let r=new $.Voice({num_beats:e.timeSignature.beats,beat_value:e.timeSignature.beatValue});r.setMode($.Voice.Mode.SOFT),r.addTickables(l),a.push(r)}),a.length&&(new $.Formatter().joinVoices(a).format(a,180),a.forEach(e=>e.draw(t,r))),n+=200})}constructor({container:e,score:t,selection:n}){this.container=e,this.score=t,this.selection=n}}let et=J.Ay;class en{render(){if(!this.container||!this.score)return;this.container.innerHTML="";let e=new et.Renderer(this.container,et.Renderer.Backends.SVG);e.resize(900,1400);let t=e.getContext(),n=20,i=40;this.score.measures.forEach((e,l)=>{l%4==0&&0!==l&&(n=20,i+=150);let r=new et.TabStave(n,i,200);0===l&&r.addClef("tab"),r.setContext(t).draw();let s=[],a=[];e.voices.forEach(t=>{if(!t.elements.length)return;let n=new Map;t.elements.forEach(e=>{let t=e.beat;n.has(t)||n.set(t,[]),n.get(t).push(e.note)});let i=Array.from(n.keys()).sort((e,t)=>e-t),l=[],r=[];i.forEach(e=>{let t,i=n.get(e);if(!i||0===i.length)return;let s=i[0],a=(null==(o=s.duration)?void 0:o.symbol)||"q";if(s.isRest)t=new et.GhostNote({duration:a});else{let e=i.map(e=>({str:e.string||1,fret:e.fret||0}));t=new et.TabNote({positions:e,duration:a}),i.forEach((e,n)=>{if("bend"===e.technique&&t.addModifier(new et.Bend(e.bend||"Full"),n),["slide","hammer","pull"].includes(e.technique)){let i=new et.Annotation({slide:"sl.",hammer:"H",pull:"P"}[e.technique]);i.setFont("Arial",10,"italic"),t.addModifier(i,n)}});var o,c,d=t,u=this.selection;let n=null==(c=d.getSVGElement)?void 0:c.call(d);n&&(n.style.cursor="pointer",n.addEventListener("click",e=>{e.stopPropagation(),u.select(s)}))}l.push(t),r.push({group:i,tabNote:t})}),r.forEach((e,t)=>{if(t>=r.length-1)return;let n=r[t+1];e.group.forEach((t,i)=>{if(["slide","hammer","pull"].includes(t.technique)){let l=n.group.findIndex(e=>e.string===t.string);if(-1!==l){let r,a={first_note:e.tabNote,last_note:n.tabNote,first_indices:[i],last_indices:[l]};"slide"===t.technique?r=new et.TabSlide(a):"hammer"===t.technique?r=new et.HammerOn(a):"pull"===t.technique&&(r=new et.PullOff(a)),r&&s.push(r)}}})});let o=new et.Voice({num_beats:e.timeSignature.beats,beat_value:e.timeSignature.beatValue});o.setMode(et.Voice.Mode.SOFT),o.addTickables(l),a.push(o)}),a.length&&(new et.Formatter().joinVoices(a).format(a,180),a.forEach(e=>e.draw(t,r)),s.forEach(e=>e.setContext(t).draw())),n+=200})}constructor({container:e,score:t,selection:n}){this.container=e,this.score=t,this.selection=n}}class ei{render(){this.score&&(this.notationContainer.innerHTML="",this.tabContainer.innerHTML="",new ee({container:this.notationContainer,score:this.score,selection:this.selection}).render(),new en({container:this.tabContainer,score:this.score,selection:this.selection}).render())}constructor({notationContainer:e,tabContainer:t,score:n,selection:i}){this.notationContainer=e,this.tabContainer=t,this.score=n,this.selection=i}}let el={START_X:20,MEASURE_WIDTH:200,MEASURES_PER_LINE:4,SYSTEM_HEIGHT:{notation:120,tab:150},START_Y:40};function er(e){let{activeTab:t}=e,{playback:n,score:r}=(0,a.QG)(),[s,o]=(0,l.useState)(0),c=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(n)return n.onBeat=e=>{o(e)},()=>{n.onBeat=null}},[n]);let d=r&&n&&n.isPlaying,u=0,h=0,x=0,A=4;if(d)for(let e=0;e<r.measures.length;e++){let t=r.measures[e].timeSignature.beats;if(s>=x&&s<x+t){u=e,h=s-x,A=t;break}x+=t}let f=Math.floor(u/el.MEASURES_PER_LINE),m=u%el.MEASURES_PER_LINE,p=el.START_X+m*el.MEASURE_WIDTH+h/A*(el.MEASURE_WIDTH-20)+15,j=el.START_Y+f*el.SYSTEM_HEIGHT[t];return((0,l.useEffect)(()=>{d&&c.current&&c.current.scrollIntoView({block:"center",behavior:"smooth"})},[f,d]),d)?(0,i.jsx)("div",{ref:c,style:{position:"absolute",left:p,top:j,transform:"translateX(-1px)",width:2,height:100,backgroundColor:"rgba(255, 0, 0, 0.5)",zIndex:100,pointerEvents:"none",transition:"left 0.1s linear, top 0.2s ease"}}):null}function es(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),{score:n,selection:r}=(0,a.QG)(),[s,o]=(0,l.useState)("notation");return((0,l.useEffect)(()=>{n&&new ei({notationContainer:e.current,tabContainer:t.current,score:n,selection:r}).render()},[n,n]),n)?(0,i.jsxs)("div",{style:{width:"100%",paddingBottom:60},children:[(0,i.jsxs)("div",{style:{display:"flex",width:"100%",border:"1px solid #ccc",overflow:"hidden",background:"#fafafa"},children:[(0,i.jsx)("button",{onClick:()=>o("notation"),style:{width:"50%",padding:"12px 0",fontSize:16,fontWeight:"notation"===s?"bold":"normal",background:"notation"===s?"#1976d2":"#eaeaea",color:"notation"===s?"#fff":"#333",border:"none",cursor:"pointer"},children:"SCORE"}),(0,i.jsx)("button",{onClick:()=>o("tab"),style:{width:"50%",padding:"12px 0",fontSize:16,fontWeight:"tab"===s?"bold":"normal",background:"tab"===s?"#1976d2":"#eaeaea",color:"tab"===s?"#fff":"#333",border:"none",cursor:"pointer"},children:"TAB"})]}),(0,i.jsx)("div",{style:{height:40}}),(0,i.jsxs)("div",{style:{position:"relative",minHeight:300},children:[(0,i.jsx)(er,{activeTab:s}),(0,i.jsx)("div",{ref:e,className:"notation",style:{width:"100%",minHeight:300,visibility:"notation"===s?"visible":"hidden",position:"notation"===s?"relative":"absolute",top:0,left:0,opacity:+("notation"===s),pointerEvents:"notation"===s?"auto":"none",transition:"opacity 0.2s"}}),(0,i.jsx)("div",{ref:t,className:"tablature",style:{width:"100%",minHeight:200,visibility:"tab"===s?"visible":"hidden",position:"tab"===s?"relative":"absolute",top:0,left:0,opacity:+("tab"===s),pointerEvents:"tab"===s?"auto":"none",transition:"opacity 0.2s"}})]})]}):(0,i.jsx)("div",{style:{padding:20,textAlign:"center"},children:"Loading score…"})}var ea=n(41316),eo=n(87619),ec=n(18952),ed=n(3061),eu=n(76543),eh=n(71918),ex=n(5502);function eA(){var e,t;let{selection:n,updateScore:r,deleteNote:s,insertNoteFromStringFret:d}=(0,a.QG)(),[h,x]=(0,l.useState)(null);if((0,l.useEffect)(()=>(x(n.selected),n.subscribe(x)),[n]),!h)return(0,i.jsxs)(o.A,{sx:{width:300,p:2,borderLeft:"1px solid #ddd",bgcolor:"#fafafa"},children:[(0,i.jsx)(Y.A,{variant:"h6",gutterBottom:!0,children:"Inspector"}),(0,i.jsxs)(o.A,{sx:{mb:3,p:2,bgcolor:"#fff",borderRadius:1,border:"1px solid #ddd"},children:[(0,i.jsx)(Y.A,{variant:"subtitle2",sx:{mb:1},children:"Quick Input"}),(0,i.jsxs)(ea.Ay,{container:!0,spacing:1,children:[(0,i.jsx)(ea.Ay,{item:!0,xs:6,children:(0,i.jsx)(eo.A,{id:"quick-input-string",label:"String",type:"number",size:"small",fullWidth:!0,defaultValue:1,inputProps:{min:1,max:6}})}),(0,i.jsx)(ea.Ay,{item:!0,xs:6,children:(0,i.jsx)(eo.A,{id:"quick-input-fret",label:"Fret",type:"number",size:"small",fullWidth:!0,defaultValue:0,inputProps:{min:0,max:24}})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(c.A,{variant:"contained",fullWidth:!0,onClick:()=>{var e,t;let n=parseInt(null==(e=document.getElementById("quick-input-string"))?void 0:e.value),i=parseInt(null==(t=document.getElementById("quick-input-fret"))?void 0:t.value);!isNaN(n)&&!isNaN(i)&&n>=1&&n<=6&&i>=0&&d(n,i)},children:"Insert Note"})})]})]}),(0,i.jsx)(Y.A,{variant:"body2",color:"textSecondary",children:"Select a note to edit properties."})]});let A=e=>{r(t=>{let n=null;e:for(let e of t.measures)for(let t of e.voices){let e=t.elements.find(e=>e.note.id===h.id);if(e){n=e.note;break e}}n&&e(n)})},f=(e,t)=>{A(n=>{n.pitch||(n.pitch=new b.A),n.pitch[e]=t})},m=h.pitch||{step:"C",alter:0,octave:4},p=h.duration||{symbol:"q"};return(0,i.jsxs)(o.A,{sx:{width:300,p:2,borderLeft:"1px solid #ddd",bgcolor:"#fafafa",overflowY:"auto",height:"100%"},children:[(0,i.jsx)(Y.A,{variant:"h6",gutterBottom:!0,children:"Note Inspector"}),(0,i.jsxs)(ea.Ay,{container:!0,spacing:2,children:[(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(Y.A,{variant:"subtitle2",sx:{mt:1},children:"Pitch"})}),(0,i.jsx)(ea.Ay,{item:!0,xs:4,children:(0,i.jsxs)(ec.A,{fullWidth:!0,size:"small",children:[(0,i.jsx)(ed.A,{children:"Step"}),(0,i.jsx)(eu.A,{value:m.step,label:"Step",onChange:e=>f("step",e.target.value),children:["C","D","E","F","G","A","B"].map(e=>(0,i.jsx)(u.A,{value:e,children:e},e))})]})}),(0,i.jsx)(ea.Ay,{item:!0,xs:4,children:(0,i.jsxs)(ec.A,{fullWidth:!0,size:"small",children:[(0,i.jsx)(ed.A,{children:"Acc"}),(0,i.jsxs)(eu.A,{value:m.alter,label:"Acc",onChange:e=>f("alter",e.target.value),children:[(0,i.jsx)(u.A,{value:0,children:"Nat"}),(0,i.jsx)(u.A,{value:1,children:"#"}),(0,i.jsx)(u.A,{value:-1,children:"b"}),(0,i.jsx)(u.A,{value:2,children:"##"}),(0,i.jsx)(u.A,{value:-2,children:"bb"})]})]})}),(0,i.jsx)(ea.Ay,{item:!0,xs:4,children:(0,i.jsx)(eo.A,{label:"Oct",type:"number",size:"small",value:m.octave,onChange:e=>f("octave",parseInt(e.target.value)),inputProps:{min:0,max:9}})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(B.A,{})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsxs)(ec.A,{fullWidth:!0,size:"small",children:[(0,i.jsx)(ed.A,{children:"Duration"}),(0,i.jsxs)(eu.A,{value:p.symbol,label:"Duration",onChange:e=>{var t;return t=e.target.value,void A(e=>{e.duration=new j.A(t)})},children:[(0,i.jsx)(u.A,{value:"w",children:"Whole"}),(0,i.jsx)(u.A,{value:"h",children:"Half"}),(0,i.jsx)(u.A,{value:"q",children:"Quarter"}),(0,i.jsx)(u.A,{value:"8",children:"8th"}),(0,i.jsx)(u.A,{value:"16",children:"16th"}),(0,i.jsx)(u.A,{value:"32",children:"32nd"})]})]})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(eh.A,{control:(0,i.jsx)(ex.A,{checked:h.isRest,onChange:()=>{A(e=>{e.isRest=!e.isRest})}}),label:"Rest"})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(B.A,{})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(Y.A,{variant:"subtitle2",children:"Tablature"})}),(0,i.jsx)(ea.Ay,{item:!0,xs:6,children:(0,i.jsx)(eo.A,{label:"String",type:"number",size:"small",value:null!=(e=h.string)?e:"",onChange:e=>A(t=>t.string=parseInt(e.target.value))})}),(0,i.jsx)(ea.Ay,{item:!0,xs:6,children:(0,i.jsx)(eo.A,{label:"Fret",type:"number",size:"small",value:null!=(t=h.fret)?t:"",onChange:e=>A(t=>t.fret=parseInt(e.target.value))})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(B.A,{})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsx)(Y.A,{variant:"subtitle2",children:"Techniques"})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsxs)(ec.A,{fullWidth:!0,size:"small",children:[(0,i.jsx)(ed.A,{children:"Type"}),(0,i.jsxs)(eu.A,{value:h.technique||"",label:"Type",onChange:e=>A(t=>{t.technique=e.target.value||null}),children:[(0,i.jsx)(u.A,{value:"",children:"None"}),(0,i.jsx)(u.A,{value:"slide",children:"Slide"}),(0,i.jsx)(u.A,{value:"hammer",children:"Hammer-on"}),(0,i.jsx)(u.A,{value:"pull",children:"Pull-off"}),(0,i.jsx)(u.A,{value:"bend",children:"Bend"})]})]})}),"bend"===h.technique&&(0,i.jsx)(ea.Ay,{item:!0,xs:12,children:(0,i.jsxs)(ec.A,{fullWidth:!0,size:"small",children:[(0,i.jsx)(ed.A,{children:"Bend Amount"}),(0,i.jsxs)(eu.A,{value:h.bend||"Full",label:"Bend Amount",onChange:e=>A(t=>{t.bend=e.target.value}),children:[(0,i.jsx)(u.A,{value:"Half",children:"Half (1/2)"}),(0,i.jsx)(u.A,{value:"Full",children:"Full (1)"}),(0,i.jsx)(u.A,{value:"1.5",children:"1.5"}),(0,i.jsx)(u.A,{value:"2",children:"2"})]})]})}),(0,i.jsx)(ea.Ay,{item:!0,xs:12,sx:{mt:2},children:(0,i.jsx)(c.A,{variant:"contained",color:"error",fullWidth:!0,onClick:()=>{s(h),n.clear()},children:"Delete Note"})})]})]})}function ef(){return(0,i.jsxs)("div",{style:{display:"flex",width:"100%",height:"auto",minHeight:"100vh",overflow:"visible"},children:[(0,i.jsx)(Z,{}),(0,i.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",height:"auto",overflow:"visible"},children:[(0,i.jsx)(r.A,{board:"compose",showFretboardControls:!1,showCircleOfFifths:!1,showFretboard:!0,showChordComposer:!1,showProgressor:!1,showSongsSelector:!1}),(0,i.jsx)(es,{})]}),(0,i.jsx)(eA,{})]})}function em(){let[e,t]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{let e=e=>{e.shiftKey&&"?"===e.key&&t(!0)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),e)?(0,i.jsxs)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",color:"white",padding:40,zIndex:2e3},onClick:()=>t(!1),children:[(0,i.jsx)("h2",{children:"Keyboard Shortcuts"}),(0,i.jsx)("p",{children:"A–G → Insert notes"}),(0,i.jsx)("p",{children:"1,2,4,8 → Durations"}),(0,i.jsx)("p",{children:"Ctrl+Z / Ctrl+Y → Undo/Redo"}),(0,i.jsx)("p",{children:"Space → Play/Pause"})]}):null}function ep(){return(0,i.jsxs)(a.Sm,{children:[(0,i.jsx)(R,{}),(0,i.jsx)(G,{}),(0,i.jsx)(U,{}),(0,i.jsx)(ef,{}),(0,i.jsx)(em,{})]})}let ej=()=>(0,i.jsxs)("div",{style:{marginTop:"44px"},children:[(0,i.jsx)(s.A,{title:"Compose And Share Music",description:"Compose And Play Guitar Songs ON ALL KEYS, CHORDS, SHAPES, SCALES, MODES, ARPPEGIONS DERIVED FROM A COMPLETE MUSICAL LIBRARY."}),(0,i.jsx)(ep,{})]})}},e=>{e.O(0,[971,181,792,434,700,730,879,592,364,425,793,584,636,593,411],()=>e(e.s=29007)),_N_E=e.O()}]);